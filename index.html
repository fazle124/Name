<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRS-Sunrise Advanced Production System</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --info: #17a2b8;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        .container {
            display: grid;
            grid-template-columns: 220px 1fr;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h2 {
            margin: 0;
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }
        
        .logo-icon {
            width: 30px;
            height: 30px;
            background-color: var(--secondary);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .menu {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .menu-item.active {
            background-color: var(--secondary);
        }
        
        .menu-item svg {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            fill: currentColor;
        }
        
        /* Main Content Styles */
        .main-content {
            padding: 20px;
            background-color: white;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .card-title {
            margin-top: 0;
            color: var(--primary);
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }
        
        .card-title svg {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            fill: var(--secondary);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 0.9rem;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }

        .data-table td img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Scanner Styles */
        .scanner-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            border-radius: 8px;
            overflow: hidden;
            background-color: #000;
        }
        
        .scanner-video {
            width: 100%;
            display: block;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }

        .scanner-inner-frame {
            position: absolute;
            width: 70%;
            height: 70%;
            border: 2px solid white;
            border-radius: 10px;
            box-shadow: 0 0 0 100vmax rgba(0,0,0,0.5);
        }

        .scanner-inner-frame::before,
        .scanner-inner-frame::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 4px solid #fff;
        }

        .scanner-inner-frame::before {
            top: -4px;
            left: -4px;
            border-right: none;
            border-bottom: none;
        }

        .scanner-inner-frame::after {
            top: -4px;
            right: -4px;
            border-left: none;
            border-bottom: none;
        }
        
        .scanner-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            clip-path: polygon(
                0% 0%, 100% 0%, 100% 100%, 0% 100%
            );
            transition: all 0.3s ease;
        }
        
        .scanner-frame::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 15%;
            width: 70%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #fff, transparent);
            transform: translateY(-50%);
            animation: scan-line 2s infinite ease-in-out;
        }
        
        @keyframes scan-line {
            0% { transform: translateY(-50%) scaleX(0); }
            50% { transform: translateY(-50%) scaleX(1); }
            100% { transform: translateY(-50%) scaleX(0); }
        }
        
        .scan-prompt {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            text-align: center;
        }
        
        .scanner-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .scanner-actions .action-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .scanner-actions .action-btn:hover {
            color: var(--secondary);
        }
        
        .scanner-actions .action-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
            margin-bottom: 5px;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--primary);
        }
        
        .login-box {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 350px;
            max-width: 90%;
        }
        
        .login-box h2 {
            margin-top: 0;
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 0.9rem;
        }
        
        .login-box button {
            width: 100%;
            padding: 12px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
        }
        
        /* Status Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .badge-primary {
            background-color: #d1e7ff;
            color: #084298;
        }
        
        /* Alert Styles */
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Grid Layout */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-info {
                margin-top: 10px;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .text-muted {
            color: #6c757d;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        .p-3 {
            padding: 15px;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-container .form-control {
            padding-right: 40px;
        }
        
        .search-container .search-icon {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: #aaa;
        }

        .alert-box {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: fadeInOut 3s forwards;
            min-width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        .language-switcher {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-right: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="alert-container"></div>

    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h2 id="login-title">SRS-Sunrise RFID System</h2>
            <input type="text" id="loginUserId" placeholder="User ID" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button onclick="login()" id="login-button">Login</button>
        </div>
    </div>
    
    <div class="container" id="appContainer" style="display: none;">
        <div class="sidebar">
            <div class="logo">
                <h2 id="sidebar-title">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                            <path d="M11 10h2v4h-2zm0 6h2v2h-2z"/>
                        </svg>
                    </div>
                    SRS-Sunrise
                </h2>
            </div>
            
            <ul class="menu" id="mainMenu"></ul>
        </div>
        
        <div class="main-content">
            <div class="language-switcher">
                <button class="btn btn-sm btn-info" onclick="setLanguage('en')">English</button>
                <button class="btn btn-sm btn-info" onclick="setLanguage('bn')">বাংলা</button>
            </div>
            <div class="header">
                <h1 id="sectionTitle">Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="usernameDisplay">Admin</span>
                </div>
            </div>
            
            <div id="dashboard" class="section">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        <span data-lang-key="dashboard-summary-title">Today's Summary</span>
                    </h3>
                    <div class="card-grid">
                        <div class="card">
                            <h4 data-lang-key="dashboard-cards-registered">Cards Registered</h4>
                            <p id="cardsRegisteredToday">0</p>
                        </div>
                        <div class="card">
                            <h4 data-lang-key="dashboard-cards-issued">Cards Issued</h4>
                            <p id="cardsIssuedToday">0</p>
                        </div>
                        <div class="card">
                            <h4 data-lang-key="dashboard-production-pieces">Production Pieces</h4>
                            <p id="productionToday">0</p>
                        </div>
                        <div class="card">
                            <h4 data-lang-key="dashboard-active-workers">Active Workers</h4>
                            <p id="activeWorkers">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span data-lang-key="dashboard-recent-activities">Recent Activities</span>
                    </h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="time">Time</th>
                                <th data-lang-key="activity">Activity</th>
                                <th data-lang-key="user">User</th>
                                <th data-lang-key="details">Details</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivities"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="workerManagement" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <span data-lang-key="worker-entry-title">Worker Information Entry</span>
                    </h3>
                    <form id="workerForm">
                        <div class="form-group">
                            <label for="workerIdEntry" data-lang-key="worker-id">ID No:</label>
                            <input type="text" id="workerIdEntry" class="form-control" required placeholder="Enter Worker ID">
                        </div>
                        <div class="form-group">
                            <label for="workerNameEntry" data-lang-key="worker-name">Name:</label>
                            <input type="text" id="workerNameEntry" class="form-control" required placeholder="Enter Worker Name">
                        </div>
                        <div class="form-group">
                            <label for="workerDesignationEntry" data-lang-key="worker-designation">Designation:</label>
                            <input type="text" id="workerDesignationEntry" class="form-control" required placeholder="Enter Worker Designation">
                        </div>
                        <div class="form-group">
                            <label for="workerSectionEntry" data-lang-key="worker-section">Section:</label>
                            <input type="text" id="workerSectionEntry" class="form-control" required placeholder="Enter Worker Section">
                        </div>
                        <div class="form-group">
                            <label for="workerFloorEntry" data-lang-key="worker-floor">Floor:</label>
                            <input type="text" id="workerFloorEntry" class="form-control" required placeholder="Enter Worker Floor">
                        </div>
                        <div class="form-group">
                            <label for="workerJoinDateEntry" data-lang-key="worker-join-date">Join Date:</label>
                            <input type="date" id="workerJoinDateEntry" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="workerImageEntry" data-lang-key="worker-image">Image:</label>
                            <input type="file" id="workerImageEntry" class="form-control" accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="add-worker">Add Worker</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                        </svg>
                        <span data-lang-key="registered-workers-title">Registered Workers</span>
                    </h3>
                    <div class="search-container">
                        <input type="text" id="searchWorker" class="form-control" placeholder="Search workers...">
                        <span class="search-icon">&#x1F50D;</span>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="worker-id">ID No</th>
                                <th data-lang-key="worker-name">Name</th>
                                <th data-lang-key="worker-designation">Designation</th>
                                <th data-lang-key="worker-section">Section</th>
                                <th data-lang-key="worker-floor">Floor</th>
                                <th data-lang-key="worker-join-date">Join Date</th>
                                <th data-lang-key="worker-image">Image</th>
                                <th data-lang-key="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="workerList"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="cardRegistration" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>
                            <path d="M8 14h8v-2H8v2zm0-3h8V9H8v2zm0-3h5V6H8v2z"/>
                        </svg>
                        <span data-lang-key="register-card-title">Register New Card</span>
                    </h3>
                    <form id="cardRegistrationForm">
                        <div class="form-group">
                            <label for="cardNumber" data-lang-key="card-number">Card Number (RFID)</label>
                            <input type="text" id="cardNumber" class="form-control" required placeholder="Enter card number manually or use scanner">
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="register-card">Register Card</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                        </svg>
                        <span data-lang-key="registered-cards-title">Registered Cards</span>
                    </h3>
                    <div class="search-container">
                        <input type="text" id="searchCard" class="form-control" placeholder="Search card numbers...">
                        <span class="search-icon">&#x1F50D;</span>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="card-number">Card Number</th>
                                <th data-lang-key="registered-date">Registered Date</th>
                                <th data-lang-key="status">Status</th>
                                <th data-lang-key="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="registeredCardsList"></tbody>
                    </table>
                </div>
            </div>

            <div id="badCardExchange" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12zM8 14h8v-2H8v2zm0-3h8V9H8v2zm0-3h5V6H8v2z"/>
                        </svg>
                        <span data-lang-key="bad-card-exchange-title">Bad Card Exchange</span>
                    </h3>
                    <form id="badCardForm">
                        <div class="form-group">
                            <label for="oldCardNumber" data-lang-key="old-card-number">Old Card Number (Bad Card)</label>
                            <input type="text" id="oldCardNumber" class="form-control" required placeholder="Enter old card number">
                        </div>
                        <div class="form-group">
                            <label for="newCardNumber" data-lang-key="new-card-number">New Card Number (Replacement)</label>
                            <input type="text" id="newCardNumber" class="form-control" required placeholder="Enter new card number">
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="exchange-card">Exchange Card</button>
                    </form>
                </div>
            </div>
            
            <div id="lotManagement" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span data-lang-key="add-lot-title">Add New Lot</span>
                    </h3>
                    <form id="lotForm">
                        <div class="form-group">
                            <label for="lotNumber" data-lang-key="lot-number">Lot Number</label>
                            <input type="text" id="lotNumber" class="form-control" required placeholder="Enter lot number">
                        </div>
                        <div class="form-group">
                            <label for="lotStyle" data-lang-key="lot-style">Style</label>
                            <input type="text" id="lotStyle" class="form-control" required placeholder="Enter style">
                        </div>
                        <div id="sizeQuantityContainer">
                            <div class="form-group size-qty-group">
                                <label data-lang-key="lot-size-quantity">Size & Quantity</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" class="form-control lotSize" placeholder="Size" required>
                                    <input type="number" class="form-control lotQuantity" placeholder="Quantity" required>
                                    <button type="button" class="btn btn-success" onclick="addSizeQuantityInput()">+</button>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="add-lot">Add Lot</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                        </svg>
                        <span data-lang-key="available-lots-title">Available Lots</span>
                    </h3>
                    <div class="search-container">
                        <input type="text" id="searchLot" class="form-control" placeholder="Search lots...">
                        <span class="search-icon">&#x1F50D;</span>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="lot-number">Lot Number</th>
                                <th data-lang-key="lot-style">Style</th>
                                <th data-lang-key="lot-size">Size</th>
                                <th data-lang-key="lot-quantity">Quantity</th>
                                <th data-lang-key="added-date">Added Date</th>
                                <th data-lang-key="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="lotList"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="cardIssue" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                        </svg>
                        <span data-lang-key="issue-card-title">Issue Production Card</span>
                    </h3>
                    <form id="cardIssueForm" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="issueCardNumber" data-lang-key="card-number">Card Number</label>
                            <input type="text" id="issueCardNumber" class="form-control" required placeholder="Enter card number">
                        </div>
                        <div class="form-group">
                            <label for="issueLotNumber" data-lang-key="lot-number">Lot Number</label>
                            <select id="issueLotNumber" class="form-control" required>
                                <option value="" data-lang-key="select-lot">Select Lot Number</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="issueStyle" data-lang-key="lot-style">Style</label>
                            <input type="text" id="issueStyle" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="issueLine" data-lang-key="work-line">Work Line</label>
                            <select id="issueLine" class="form-control" required>
                                <option value="" data-lang-key="select-line">Select Work Line</option>
                                <option value="Line-101">Line-101</option>
                                <option value="Line-102">Line-102</option>
                                <option value="Line-103">Line-103</option>
                                <option value="Swing-QC">Swing QC</option>
                                <option value="Finishing">Finishing</option>
                                <option value="Input">Input</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="issueSize" data-lang-key="lot-size">Size</label>
                            <select id="issueSize" class="form-control" required>
                                <option value="" data-lang-key="select-size">Select Size</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="issueQuantity" data-lang-key="quantity">Quantity (Qty)</label>
                            <input type="number" id="issueQuantity" class="form-control" required placeholder="Enter quantity">
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="issue-card">Issue Card</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z"/>
                        </svg>
                        <span data-lang-key="issued-cards-title">Issued Cards</span>
                    </h3>
                    <div class="search-container">
                        <input type="text" id="searchIssuedCard" class="form-control" placeholder="Search issued cards...">
                        <span class="search-icon">&#x1F50D;</span>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="card-number">Card Number</th>
                                <th data-lang-key="lot-number">Lot Number</th>
                                <th data-lang-key="lot-style">Style</th>
                                <th data-lang-key="lot-size">Size</th>
                                <th data-lang-key="quantity">Quantity</th>
                                <th data-lang-key="work-line">Work Line</th>
                                <th data-lang-key="issue-date">Issue Date</th>
                                <th data-lang-key="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="issuedCardsList"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="workerPunch" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <span data-lang-key="worker-punch-title">Worker Punch (Production Entry)</span>
                    </h3>
                    <div class="card-body">
                        <p data-lang-key="punch-instruction">Scan or enter the production card number to record production.</p>
                        <div class="scanner-container">
                            <video id="punch-scanner-video" class="scanner-video" playsinline></video>
                            <canvas id="punch-scanner-canvas" style="display:none;"></canvas>
                            <div class="scanner-overlay">
                                <div class="scanner-inner-frame"></div>
                                <div class="scan-prompt" data-lang-key="scan-prompt-text">Place the code inside the frame</div>
                            </div>
                        </div>
                        <p class="scan-status" id="punch-scan-status" data-lang-key="scanner-status">Initializing scanner...</p>
                        <div class="scanner-actions">
                            <button class="action-btn" onclick="document.getElementById('punch-file-input').click()">
                                <svg viewBox="0 0 24 24"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM14 9l-3 4-2-2-4 5h12z"/></svg>
                                <span data-lang-key="gallery">Gallery</span>
                            </button>
                            <input type="file" id="punch-file-input" accept="image/*" style="display:none;" onchange="handleImageUpload(event, 'workerPunch')">
                        </div>
                    </div>
                    
                    <form id="workerPunchForm" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="punchCardNumber" data-lang-key="card-number">Card Number</label>
                            <input type="text" id="punchCardNumber" class="form-control" required placeholder="Enter or scan card number">
                        </div>
                        <div class="form-group">
                            <label for="punchLotNumber" data-lang-key="lot-number">Lot Number</label>
                            <input type="text" id="punchLotNumber" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="punchStyle" data-lang-key="lot-style">Style</label>
                            <input type="text" id="punchStyle" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="punchSize" data-lang-key="lot-size">Size</label>
                            <input type="text" id="punchSize" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="punchQuantity" data-lang-key="quantity">Quantity (Qty)</label>
                            <input type="number" id="punchQuantity" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="punchWorkLine" data-lang-key="work-line">Work Line</label>
                            <input type="text" id="punchWorkLine" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="punchWorkerId" data-lang-key="worker-id">Worker ID</label>
                            <input type="text" id="punchWorkerId" class="form-control" required placeholder="Enter Worker ID">
                        </div>
                        <div class="form-group">
                            <label for="punchWorkerName" data-lang-key="worker-name">Worker Name</label>
                            <input type="text" id="punchWorkerName" class="form-control" readonly>
                        </div>
                        <button type="submit" class="btn btn-success" data-lang-key="record-production">Record Production</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span data-lang-key="today-production-title">Today's Production</span>
                    </h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="time">Time</th>
                                <th data-lang-key="worker">Worker</th>
                                <th data-lang-key="lot-number">Lot Number</th>
                                <th data-lang-key="lot-style">Style</th>
                                <th data-lang-key="lot-size">Size</th>
                                <th data-lang-key="quantity">Quantity</th>
                                <th data-lang-key="work-line">Work Line</th>
                            </tr>
                        </thead>
                        <tbody id="todayProduction"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="productionTracking" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z"/>
                        </svg>
                        <span data-lang-key="production-tracking-title">Track Production</span>
                    </h3>
                    <div class="form-group">
                        <label for="trackCardNumber" data-lang-key="enter-card-track">Enter Card Number to Track</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="trackCardNumber" class="form-control" placeholder="Scan or enter card number">
                            <button onclick="trackProduction()" class="btn btn-primary" data-lang-key="track">Track</button>
                        </div>
                    </div>
                    <div id="trackingResults" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div id="reports" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span data-lang-key="generate-reports-title">Generate Reports</span>
                    </h3>
                    <div class="card-grid">
                        <div class="card">
                            <h4 data-lang-key="worker-report-title">Worker Production Report</h4>
                            <p data-lang-key="worker-report-desc">Detailed production by worker</p>
                            <div class="form-group mt-3">
                                <label for="reportWorkerDate" data-lang-key="select-date">Select Date</label>
                                <input type="date" id="reportWorkerDate" class="form-control">
                            </div>
                            <button onclick="generateWorkerReport()" class="btn btn-primary" style="margin-top: 10px;" data-lang-key="generate">Generate</button>
                        </div>
                        <div class="card">
                            <h4 data-lang-key="lot-report-title">Lot Progress Report</h4>
                            <p data-lang-key="lot-report-desc">Manufacturing order progress</p>
                            <div class="form-group mt-3">
                                <label for="reportLotNumber" data-lang-key="select-lot">Select Lot</label>
                                <select id="reportLotNumber" class="form-control">
                                    <option value="" data-lang-key="all-lots">All Lots</option>
                                </select>
                            </div>
                            <button onclick="generateLotReport()" class="btn btn-primary" style="margin-top: 10px;" data-lang-key="generate">Generate</button>
                        </div>
                        <div class="card">
                            <h4 data-lang-key="attendance-report-title">Worker Attendance Report</h4>
                            <p data-lang-key="attendance-report-desc">Monthly present/absent list for workers</p>
                            <div class="form-group mt-3">
                                <label for="reportWorkerMonth" data-lang-key="select-month">Select Month</label>
                                <input type="month" id="reportWorkerMonth" class="form-control">
                            </div>
                            <button onclick="generateAttendanceReport()" class="btn btn-primary" style="margin-top: 10px;" data-lang-key="generate">Generate</button>
                        </div>
                    </div>
                    <div class="card mt-3" id="reportResultsContainer" style="display: none;">
                        <h3 class="card-title" data-lang-key="report-results-title">Report Results</h3>
                        <div id="reportResults"></div>
                    </div>
                </div>
            </div>
            
            <div id="userManagement" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <span data-lang-key="user-management-title">User Management</span>
                    </h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-lang-key="user-id">User ID</th>
                                <th data-lang-key="user-name">Name</th>
                                <th data-lang-key="user-role">Role</th>
                                <th data-lang-key="last-login">Last Login</th>
                                <th data-lang-key="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userList"></tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                        </svg>
                        <span data-lang-key="add-user-title">Add New User</span>
                    </h3>
                    <form id="addUserForm">
                        <div class="form-group">
                            <label for="newUserId" data-lang-key="user-id">User ID</label>
                            <input type="text" id="newUserId" class="form-control" required placeholder="Enter user ID">
                        </div>
                        <div class="form-group">
                            <label for="newUserName" data-lang-key="user-name">Name</label>
                            <input type="text" id="newUserName" class="form-control" required placeholder="Enter name">
                        </div>
                        <div class="form-group">
                            <label for="newUserPassword" data-lang-key="user-password">Password</label>
                            <input type="password" id="newUserPassword" class="form-control" required placeholder="Enter password">
                        </div>
                        <div class="form-group">
                            <label for="newUserRole" data-lang-key="user-role">Role</label>
                            <select id="newUserRole" class="form-control" required>
                                <option value="admin" data-lang-key="role-admin">Admin</option>
                                <option value="supervisor" data-lang-key="role-supervisor">Supervisor</option>
                                <option value="operator" data-lang-key="role-operator">Operator</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newUserPermissions" data-lang-key="user-permissions">Permissions</label>
                            <div id="permissionCheckboxes"></div>
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="add-user">Add User</button>
                    </form>
                </div>
            </div>

            <div id="profile" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <span data-lang-key="profile-title">Profile</span>
                    </h3>
                    <form id="profileForm">
                        <div class="form-group text-center">
                            <label data-lang-key="profile-picture">Profile Picture</label>
                            <div class="user-avatar" style="margin: 0 auto; width: 100px; height: 100px; cursor: pointer;" onclick="document.getElementById('profileImageInput').click()">
                                <img id="profileImageDisplay" src="" alt="Profile Image">
                            </div>
                            <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="updateProfileImage()">
                        </div>
                        <div class="form-group">
                            <label for="currentPassword" data-lang-key="current-password">Current Password</label>
                            <input type="password" id="currentPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword" data-lang-key="new-password">New Password</label>
                            <input type="password" id="newPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword" data-lang-key="confirm-password">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary" data-lang-key="change-password">Change Password</button>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Language support
        const translations = {
            en: {
                "login-title": "SRS-Sunrise RFID System",
                "login-button": "Login",
                "sidebar-title": "SRS-Sunrise",
                "dashboard": "Dashboard",
                "worker-management": "Worker Management",
                "card-registration": "Card Registration",
                "bad-card-exchange": "Bad Card Exchange",
                "lot-management": "Lot Management",
                "card-issue": "Card Issue",
                "worker-punch": "Worker Punch",
                "production-tracking": "Production Tracking",
                "reports": "Reports",
                "user-management": "User Management",
                "profile": "Profile",
                "logout": "Logout",
                "dashboard-summary-title": "Today's Summary",
                "dashboard-cards-registered": "Cards Registered",
                "dashboard-cards-issued": "Cards Issued",
                "dashboard-production-pieces": "Production Pieces",
                "dashboard-active-workers": "Active Workers",
                "dashboard-recent-activities": "Recent Activities",
                "time": "Time",
                "activity": "Activity",
                "user": "User",
                "details": "Details",
                "worker-entry-title": "Worker Information Entry",
                "worker-id": "ID No",
                "worker-name": "Name",
                "worker-designation": "Designation",
                "worker-section": "Section",
                "worker-floor": "Floor",
                "worker-join-date": "Join Date",
                "worker-image": "Image",
                "add-worker": "Add Worker",
                "registered-workers-title": "Registered Workers",
                "actions": "Actions",
                "register-card-title": "Register New Card",
                "card-number": "Card Number",
                "register-card": "Register Card",
                "registered-cards-title": "Registered Cards",
                "registered-date": "Registered Date",
                "status": "Status",
                "bad-card-exchange-title": "Bad Card Exchange",
                "old-card-number": "Old Card Number (Bad Card)",
                "new-card-number": "New Card Number (Replacement)",
                "exchange-card": "Exchange Card",
                "add-lot-title": "Add New Lot",
                "lot-number": "Lot Number",
                "lot-style": "Style",
                "lot-size-quantity": "Size & Quantity",
                "add-lot": "Add Lot",
                "available-lots-title": "Available Lots",
                "lot-size": "Size",
                "lot-quantity": "Quantity",
                "added-date": "Added Date",
                "card-issue-title": "Issue Production Card",
                "select-lot": "Select Lot Number",
                "work-line": "Work Line",
                "select-line": "Select Work Line",
                "select-size": "Select Size",
                "quantity": "Quantity (Qty)",
                "issue-card": "Issue Card",
                "issued-cards-title": "Issued Cards",
                "issue-date": "Issue Date",
                "worker-punch-title": "Worker Punch (Production Entry)",
                "punch-instruction": "Scan or enter the production card number to record production.",
                "scan-prompt-text": "Place the code inside the frame",
                "scanner-status": "Initializing scanner...",
                "gallery": "Gallery",
                "record-production": "Record Production",
                "today-production-title": "Today's Production",
                "worker": "Worker",
                "production-tracking-title": "Track Production",
                "enter-card-track": "Enter Card Number to Track",
                "track": "Track",
                "generate-reports-title": "Generate Reports",
                "worker-report-title": "Worker Production Report",
                "worker-report-desc": "Detailed production by worker",
                "select-date": "Select Date",
                "generate": "Generate",
                "lot-report-title": "Lot Progress Report",
                "lot-report-desc": "Manufacturing order progress",
                "select-lot": "Select Lot",
                "all-lots": "All Lots",
                "attendance-report-title": "Worker Attendance Report",
                "attendance-report-desc": "Monthly present/absent list for workers",
                "select-month": "Select Month",
                "report-results-title": "Report Results",
                "user-management-title": "User Management",
                "user-id": "User ID",
                "user-name": "Name",
                "user-role": "Role",
                "last-login": "Last Login",
                "add-user-title": "Add New User",
                "user-password": "Password",
                "user-permissions": "Permissions",
                "add-user": "Add User",
                "profile-title": "Profile",
                "profile-picture": "Profile Picture",
                "current-password": "Current Password",
                "new-password": "New Password",
                "confirm-password": "Confirm New Password",
                "change-password": "Change Password",
                "role-admin": "Admin",
                "role-supervisor": "Supervisor",
                "role-operator": "Operator",
            },
            bn: {
                "login-title": "এসআরএস-সানরাইজ আরএফআইডি সিস্টেম",
                "login-button": "লগইন",
                "sidebar-title": "এসআরএস-সানরাইজ",
                "dashboard": "ড্যাশবোর্ড",
                "worker-management": "কর্মী ব্যবস্থাপনা",
                "card-registration": "কার্ড নিবন্ধন",
                "bad-card-exchange": "নষ্ট কার্ড বিনিময়",
                "lot-management": "লট ব্যবস্থাপনা",
                "card-issue": "কার্ড ইস্যু",
                "worker-punch": "কর্মী পাঞ্চ",
                "production-tracking": "উৎপাদন ট্র্যাকিং",
                "reports": "রিপোর্ট",
                "user-management": "ব্যবহারকারী ব্যবস্থাপনা",
                "profile": "প্রোফাইল",
                "logout": "লগআউট",
                "dashboard-summary-title": "আজকের সারসংক্ষেপ",
                "dashboard-cards-registered": "নিবন্ধিত কার্ড",
                "dashboard-cards-issued": "ইস্যু করা কার্ড",
                "dashboard-production-pieces": "উৎপাদিত পিস",
                "dashboard-active-workers": "সক্রিয় কর্মী",
                "dashboard-recent-activities": "সাম্প্রতিক কার্যক্রম",
                "time": "সময়",
                "activity": "কার্যকলাপ",
                "user": "ব্যবহারকারী",
                "details": "বিস্তারিত",
                "worker-entry-title": "কর্মী তথ্য এন্ট্রি",
                "worker-id": "আইডি নং",
                "worker-name": "নাম",
                "worker-designation": "পদবী",
                "worker-section": "সেকশন",
                "worker-floor": "ফ্লোর",
                "worker-join-date": "যোগদানের তারিখ",
                "worker-image": "ছবি",
                "add-worker": "কর্মী যোগ করুন",
                "registered-workers-title": "নিবন্ধিত কর্মী",
                "actions": "অ্যাকশন",
                "register-card-title": "নতুন কার্ড নিবন্ধন করুন",
                "card-number": "কার্ড নাম্বার",
                "register-card": "কার্ড নিবন্ধন",
                "registered-cards-title": "নিবন্ধিত কার্ড",
                "registered-date": "নিবন্ধনের তারিখ",
                "status": "অবস্থা",
                "bad-card-exchange-title": "নষ্ট কার্ড বিনিময়",
                "old-card-number": "পুরানো কার্ড নাম্বার (নষ্ট কার্ড)",
                "new-card-number": "নতুন কার্ড নাম্বার (বিকল্প)",
                "exchange-card": "কার্ড বিনিময়",
                "add-lot-title": "নতুন লট যোগ করুন",
                "lot-number": "লট নাম্বার",
                "lot-style": "স্টাইল",
                "lot-size-quantity": "সাইজ এবং পরিমাণ",
                "add-lot": "লট যোগ করুন",
                "available-lots-title": "উপলব্ধ লট",
                "lot-size": "সাইজ",
                "lot-quantity": "পরিমাণ",
                "added-date": "যোগদানের তারিখ",
                "card-issue-title": "উৎপাদন কার্ড ইস্যু করুন",
                "select-lot": "লট নাম্বার নির্বাচন করুন",
                "work-line": "ওয়ার্ক লাইন",
                "select-line": "ওয়ার্ক লাইন নির্বাচন করুন",
                "select-size": "সাইজ নির্বাচন করুন",
                "quantity": "পরিমাণ (পিস)",
                "issue-card": "কার্ড ইস্যু করুন",
                "issued-cards-title": "ইস্যু করা কার্ড",
                "issue-date": "ইস্যু তারিখ",
                "worker-punch-title": "কর্মী পাঞ্চ (উৎপাদন এন্ট্রি)",
                "punch-instruction": "উৎপাদন রেকর্ড করতে প্রোডাকশন কার্ড নাম্বার স্ক্যান বা এন্ট্রি করুন।",
                "scan-prompt-text": "কোডটি ফ্রেমের মধ্যে রাখুন",
                "scanner-status": "স্ক্যানার চালু হচ্ছে...",
                "gallery": "গ্যালারি",
                "record-production": "উৎপাদন রেকর্ড করুন",
                "today-production-title": "আজকের উৎপাদন",
                "worker": "কর্মী",
                "production-tracking-title": "উৎপাদন ট্র্যাকিং",
                "enter-card-track": "ট্র্যাক করতে কার্ড নাম্বার দিন",
                "track": "ট্র্যাক",
                "generate-reports-title": "রিপোর্ট তৈরি করুন",
                "worker-report-title": "কর্মী উৎপাদন রিপোর্ট",
                "worker-report-desc": "কর্মী অনুসারে বিস্তারিত উৎপাদন",
                "select-date": "তারিখ নির্বাচন করুন",
                "generate": "তৈরি করুন",
                "lot-report-title": "লট অগ্রগতি রিপোর্ট",
                "lot-report-desc": "ম্যানুফ্যাকচারিং অর্ডারের অগ্রগতি",
                "select-lot": "লট নির্বাচন করুন",
                "all-lots": "সকল লট",
                "attendance-report-title": "কর্মী উপস্থিতি রিপোর্ট",
                "attendance-report-desc": "কর্মীদের মাসিক উপস্থিতি/অনুপস্থিতির তালিকা",
                "select-month": "মাস নির্বাচন করুন",
                "report-results-title": "রিপোর্ট ফলাফল",
                "user-management-title": "ব্যবহারকারী ব্যবস্থাপনা",
                "user-id": "ব্যবহারকারী আইডি",
                "user-name": "নাম",
                "user-role": "ভূমিকা",
                "last-login": "শেষ লগইন",
                "add-user-title": "নতুন ব্যবহারকারী যোগ করুন",
                "user-password": "পাসওয়ার্ড",
                "user-permissions": "অনুমতিসমূহ",
                "add-user": "ব্যবহারকারী যোগ করুন",
                "profile-title": "প্রোফাইল",
                "profile-picture": "প্রোফাইল ছবি",
                "current-password": "বর্তমান পাসওয়ার্ড",
                "new-password": "নতুন পাসওয়ার্ড",
                "confirm-password": "নতুন পাসওয়ার্ড নিশ্চিত করুন",
                "change-password": "পাসওয়ার্ড পরিবর্তন",
                "role-admin": "অ্যাডমিন",
                "role-supervisor": "সুপারভাইজার",
                "role-operator": "অপারেটর",
            }
        };

        // User permissions map
        const permissionsMap = {
            'view-dashboard': { en: 'View Dashboard', bn: 'ড্যাশবোর্ড দেখুন' },
            'manage-workers': { en: 'Manage Workers (Add/Edit/Delete)', bn: 'কর্মী পরিচালনা (যোগ/সম্পাদনা/মুছে ফেলা)' },
            'register-cards': { en: 'Register Cards', bn: 'কার্ড নিবন্ধন' },
            'exchange-bad-cards': { en: 'Exchange Bad Cards', bn: 'নষ্ট কার্ড বিনিময়' },
            'manage-lots': { en: 'Manage Lots (Add/Edit/Delete)', bn: 'লট পরিচালনা (যোগ/সম্পাদনা/মুছে ফেলা)' },
            'issue-cards': { en: 'Issue Cards', bn: 'কার্ড ইস্যু' },
            'record-production': { en: 'Record Production (Worker Punch)', bn: 'উৎপাদন রেকর্ড (কর্মী পাঞ্চ)' },
            'track-production': { en: 'Track Production', bn: 'উৎপাদন ট্র্যাকিং' },
            'generate-reports': { en: 'Generate Reports', bn: 'রিপোর্ট তৈরি' },
            'manage-users': { en: 'Manage Users (Add/Edit/Delete)', bn: 'ব্যবহারকারী পরিচালনা (যোগ/সম্পাদনা/মুছে ফেলা)' },
            'view-profile': { en: 'View Profile', bn: 'প্রোফাইল দেখুন' }
        };

        // Database
        let users = [
            { id: "aradmin", password: "127627", name: "Admin", role: "admin", lastLogin: "", permissions: Object.keys(permissionsMap), image: "" },
            { id: "supervisor1", password: "123", name: "Production Supervisor", role: "supervisor", lastLogin: "", permissions: ["view-dashboard", "manage-workers", "register-cards", "exchange-bad-cards", "issue-cards", "record-production", "track-production", "generate-reports", "view-profile"], image: "" },
            { id: "operator1", password: "123", name: "Line Operator", role: "operator", lastLogin: "", permissions: ["view-dashboard", "record-production", "track-production", "view-profile"], image: "" }
        ];
        
        let workers = [
            { workerId: "W001", workerName: "Abdul Karim", designation: "Swing Operator", section: "Swing", floor: "2nd", joinDate: "2024-01-15", image: "https://i.ibb.co/L5kR7wM/worker1.jpg" },
            { workerId: "W002", workerName: "Rahima Begum", designation: "QC", section: "Quality Control", floor: "3rd", joinDate: "2023-10-20", image: "https://i.ibb.co/hK70R9C/worker2.jpg" },
            { workerId: "W003", workerName: "Jamal Uddin", designation: "Finishing Operator", section: "Finishing", floor: "4th", joinDate: "2024-03-01", image: "https://i.ibb.co/3WqP4Sg/worker3.jpg" }
        ];

        let registeredCards = [];
        let issuedCards = [];
        let productionData = [];
        let activities = [];
        let lots = [];
        
        let currentUser = null;
        let currentLang = 'en';

        // Initialize with sample data
        function initializeSampleData() {
            if (registeredCards.length === 0) {
                registeredCards = [
                    { cardNumber: "RFID001", registeredDate: "2025-08-01", status: "active" },
                    { cardNumber: "RFID002", registeredDate: "2025-08-01", status: "active" },
                    { cardNumber: "RFID003", registeredDate: "2025-08-02", status: "active" }
                ];
            }
            
            if (lots.length === 0) {
                lots = [
                    { lotNumber: "LOT-2025-001", style: "STYLE-101", sizes: { "S": 100, "M": 200, "L": 200 }, addedDate: "2025-08-01" },
                    { lotNumber: "LOT-2025-002", style: "STYLE-102", sizes: { "L": 150, "XL": 150 }, addedDate: "2025-08-02" }
                ];
            }
            
            if (issuedCards.length === 0) {
                issuedCards = [
                    { cardNumber: "RFID002", lotNumber: "LOT-2025-001", style: "STYLE-101", size: "M", quantity: 50, workLine: "Line-101", issueDate: "2025-08-02 09:15" },
                    { cardNumber: "RFID003", lotNumber: "LOT-2025-002", style: "STYLE-102", size: "L", quantity: 30, workLine: "Finishing", issueDate: "2025-08-02 10:30" }
                ];
            }
            
            if (productionData.length === 0) {
                productionData = [
                    { cardNumber: "RFID002", date: "2025-08-02", time: "09:30", pieces: 50, workerId: "W001", workerName: "Abdul Karim", lotNumber: "LOT-2025-001", style: "STYLE-101", size: "M", workLine: "Line-101" },
                    { cardNumber: "RFID003", date: "2025-08-02", time: "10:45", pieces: 30, workerId: "W002", workerName: "Rahima Begum", lotNumber: "LOT-2025-002", style: "STYLE-102", size: "L", workLine: "Finishing" }
                ];
            }
            
            if (activities.length === 0) {
                activities = [
                    { time: "2025-08-02 09:15", activity: "Card Issued", user: "supervisor1", details: "RFID002 for LOT-2025-001" },
                    { time: "2025-08-02 10:30", activity: "Card Issued", user: "supervisor1", details: "RFID003 for LOT-2025-002" },
                    { time: "2025-08-02 08:00", activity: "Card Registered", user: "aradmin", details: "RFID003" },
                    { time: "2025-08-02 09:30", activity: "Production Recorded", user: "operator1", details: "50 pieces by W001" },
                    { time: "2025-08-02 10:45", activity: "Production Recorded", user: "operator1", details: "30 pieces by W002" }
                ];
            }
        }
        
        // --- Language and UI Functions ---
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            // Update placeholders
            const placeholders = {
                en: {
                    'searchWorker': 'Search workers...',
                    'searchCard': 'Search card numbers...',
                    'searchLot': 'Search lots...',
                    'searchIssuedCard': 'Search issued cards...',
                    'trackCardNumber': 'Scan or enter card number',
                    'workerIdEntry': 'Enter Worker ID',
                    'workerNameEntry': 'Enter Worker Name',
                    'workerDesignationEntry': 'Enter Worker Designation',
                    'workerSectionEntry': 'Enter Worker Section',
                    'workerFloorEntry': 'Enter Worker Floor',
                    'cardNumber': 'Enter card number manually or use scanner',
                    'oldCardNumber': 'Enter old card number',
                    'newCardNumber': 'Enter new card number',
                    'lotNumber': 'Enter lot number',
                    'lotStyle': 'Enter style',
                    'issueCardNumber': 'Enter card number',
                    'issueQuantity': 'Enter quantity',
                    'punchCardNumber': 'Enter or scan card number',
                    'punchWorkerId': 'Enter Worker ID',
                    'newUserId': 'Enter user ID',
                    'newUserName': 'Enter name',
                    'newUserPassword': 'Enter password',
                },
                bn: {
                    'searchWorker': 'কর্মী খুঁজুন...',
                    'searchCard': 'কার্ড নাম্বার খুঁজুন...',
                    'searchLot': 'লট খুঁজুন...',
                    'searchIssuedCard': 'ইস্যু করা কার্ড খুঁজুন...',
                    'trackCardNumber': 'স্ক্যান বা কার্ড নাম্বার দিন',
                    'workerIdEntry': 'কর্মী আইডি লিখুন',
                    'workerNameEntry': 'কর্মীর নাম লিখুন',
                    'workerDesignationEntry': 'কর্মীর পদবী লিখুন',
                    'workerSectionEntry': 'কর্মীর সেকশন লিখুন',
                    'workerFloorEntry': 'কর্মীর ফ্লোর লিখুন',
                    'cardNumber': 'কার্ড নাম্বার ম্যানুয়ালি বা স্ক্যানার ব্যবহার করে লিখুন',
                    'oldCardNumber': 'পুরানো কার্ড নাম্বার লিখুন',
                    'newCardNumber': 'নতুন কার্ড নাম্বার লিখুন',
                    'lotNumber': 'লট নাম্বার লিখুন',
                    'lotStyle': 'স্টাইল লিখুন',
                    'issueCardNumber': 'কার্ড নাম্বার লিখুন',
                    'issueQuantity': 'পরিমাণ লিখুন',
                    'punchCardNumber': 'কার্ড নাম্বার লিখুন বা স্ক্যান করুন',
                    'punchWorkerId': 'কর্মী আইডি লিখুন',
                    'newUserId': 'ব্যবহারকারী আইডি লিখুন',
                    'newUserName': 'নাম লিখুন',
                    'newUserPassword': 'পাসওয়ার্ড লিখুন',
                }
            };
            for (const id in placeholders[lang]) {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = placeholders[lang][id];
                }
            }
            loadPermissionsCheckboxes();
        }

        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alertBox = document.createElement('div');
            alertBox.className = `alert alert-${type} alert-box`;
            alertBox.textContent = message;
            container.appendChild(alertBox);
            setTimeout(() => {
                alertBox.remove();
            }, 3000);
        }

        // --- Core Application Logic ---

        // Login function
        function login() {
            const userId = document.getElementById("loginUserId").value;
            const password = document.getElementById("loginPassword").value;
            
            const user = users.find(u => u.id === userId && u.password === password);
            
            if (user) {
                currentUser = user;
                user.lastLogin = new Date().toLocaleString();
                
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("appContainer").style.display = "grid";
                document.getElementById("usernameDisplay").textContent = user.name;
                
                if (user.image) {
                    document.getElementById("userAvatar").innerHTML = `<img src="${user.image}" alt="User Avatar">`;
                    document.getElementById("profileImageDisplay").src = user.image;
                } else {
                    document.getElementById("userAvatar").textContent = user.name.charAt(0);
                }

                initializeSampleData();
                loadMenu();
                loadDataForCurrentSection('dashboard');
                showSection('dashboard');
                setLanguage(currentLang);
                showAlert(translations[currentLang]["login-success"], 'success');
            } else {
                showAlert(translations[currentLang]["login-invalid"], 'danger');
            }
        }
        
        function loadDataForCurrentSection(sectionId) {
            if (sectionId === 'dashboard') {
                updateDashboard();
                loadActivities();
            } else if (sectionId === 'workerManagement') {
                loadRegisteredWorkers();
                document.getElementById('searchWorker').value = '';
                document.getElementById('searchWorker').addEventListener('input', filterWorkers);
            } else if (sectionId === 'cardRegistration') {
                loadRegisteredCards();
                document.getElementById('searchCard').value = '';
                document.getElementById('searchCard').addEventListener('input', filterCards);
            } else if (sectionId === 'lotManagement') {
                loadLots();
                document.getElementById('searchLot').value = '';
                document.getElementById('searchLot').addEventListener('input', filterLots);
            } else if (sectionId === 'cardIssue') {
                loadLotOptions();
                loadIssuedCards();
                document.getElementById('searchIssuedCard').value = '';
                document.getElementById('searchIssuedCard').addEventListener('input', filterIssuedCards);
            } else if (sectionId === 'workerPunch') {
                loadTodayProduction();
            } else if (sectionId === 'reports') {
                loadReportLotOptions();
            } else if (sectionId === 'userManagement') {
                loadUserList();
                loadPermissionsCheckboxes();
            }
        }

        // Load menu based on user permissions
        function loadMenu() {
            const menu = document.getElementById("mainMenu");
            menu.innerHTML = '';
            
            const menuItems = {
                'view-dashboard': { id: 'dashboard', text: translations[currentLang]['dashboard'], svg: 'M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z' },
                'manage-workers': { id: 'workerManagement', text: translations[currentLang]['worker-management'], svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z' },
                'register-cards': { id: 'cardRegistration', text: translations[currentLang]['card-registration'], svg: 'M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12zM8 14h8v-2H8v2zm0-3h8V9H8v2zm0-3h5V6H8v2z' },
                'exchange-bad-cards': { id: 'badCardExchange', text: translations[currentLang]['bad-card-exchange'], svg: 'M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z' },
                'manage-lots': { id: 'lotManagement', text: translations[currentLang]['lot-management'], svg: 'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z' },
                'issue-cards': { id: 'cardIssue', text: translations[currentLang]['card-issue'], svg: 'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z' },
                'record-production': { id: 'workerPunch', text: translations[currentLang]['worker-punch'], svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z' },
                'track-production': { id: 'productionTracking', text: translations[currentLang]['production-tracking'], svg: 'M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z' },
                'generate-reports': { id: 'reports', text: translations[currentLang]['reports'], svg: 'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z' },
                'manage-users': { id: 'userManagement', text: translations[currentLang]['user-management'], svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z' },
                'view-profile': { id: 'profile', text: translations[currentLang]['profile'], svg: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z' }
            };

            for (const perm in menuItems) {
                if (currentUser.permissions.includes(perm)) {
                    menu.appendChild(createMenuItem(menuItems[perm].id, menuItems[perm].text, menuItems[perm].svg));
                }
            }
            
            menu.appendChild(createMenuItem('logout', translations[currentLang]['logout'], 'M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z', true));
        }
        
        // Create menu item
        function createMenuItem(sectionId, text, svgPath, isLogout = false) {
            const li = document.createElement("li");
            li.className = "menu-item";
            li.setAttribute("onclick", isLogout ? "logout()" : `showSection('${sectionId}')`);
            
            li.innerHTML = `
                <svg viewBox="0 0 24 24">
                    <path d="${svgPath}"/>
                </svg>
                <span>${text}</span>
            `;
            
            return li;
        }

        function showSection(sectionId) {
            if (sectionId === 'logout') {
                logout();
                return;
            }
            
            document.querySelectorAll(".section").forEach(section => {
                section.style.display = "none";
            });
            document.getElementById(sectionId).style.display = "block";
            
            document.querySelectorAll(".menu-item").forEach(item => {
                item.classList.remove("active");
            });
            document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add("active");
            
            const titles = {
                "dashboard": translations[currentLang]['dashboard'],
                "workerManagement": translations[currentLang]['worker-management'],
                "cardRegistration": translations[currentLang]['card-registration'],
                "badCardExchange": translations[currentLang]['bad-card-exchange'],
                "lotManagement": translations[currentLang]['lot-management'],
                "cardIssue": translations[currentLang]['card-issue'],
                "workerPunch": translations[currentLang]['worker-punch'],
                "productionTracking": translations[currentLang]['production-tracking'],
                "reports": translations[currentLang]['reports'],
                "userManagement": translations[currentLang]['user-management'],
                "profile": translations[currentLang]['profile']
            };
            document.getElementById("sectionTitle").textContent = titles[sectionId];
            
            loadDataForCurrentSection(sectionId);
        }

        // --- Data Loading and Filtering ---

        // Worker Management
        function loadRegisteredWorkers() {
            const tbody = document.getElementById("workerList");
            tbody.innerHTML = "";
            workers.forEach(worker => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${worker.workerId}</td>
                    <td>${worker.workerName}</td>
                    <td>${worker.designation}</td>
                    <td>${worker.section}</td>
                    <td>${worker.floor}</td>
                    <td>${worker.joinDate}</td>
                    <td><img src="${worker.image}" alt="${worker.workerName}"></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteWorker('${worker.workerId}')" data-lang-key="delete-button">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            setLanguage(currentLang);
        }

        function filterWorkers() {
            const searchText = document.getElementById('searchWorker').value.toLowerCase();
            const rows = document.getElementById('workerList').getElementsByTagName('tr');
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            }
        }

        // Card Registration
        function loadRegisteredCards() {
            const tbody = document.getElementById("registeredCardsList");
            tbody.innerHTML = "";
            registeredCards.forEach(card => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${card.cardNumber}</td>
                    <td>${card.registeredDate}</td>
                    <td><span class="badge ${card.status === 'active' ? 'badge-success' : 'badge-danger'}">${card.status}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deactivateCard('${card.cardNumber}')" data-lang-key="deactivate-button">Deactivate</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            setLanguage(currentLang);
        }

        function filterCards() {
            const searchText = document.getElementById('searchCard').value.toLowerCase();
            const rows = document.getElementById('registeredCardsList').getElementsByTagName('tr');
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            }
        }
        
        // Lot Management
        function loadLots() {
            const tbody = document.getElementById("lotList");
            tbody.innerHTML = "";
            lots.forEach(lot => {
                const sizesHtml = Object.entries(lot.sizes).map(([size, qty]) => `${size}: ${qty} পিছ`).join('<br>');
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${lot.lotNumber}</td>
                    <td>${lot.style}</td>
                    <td>${sizesHtml}</td>
                    <td>${Object.values(lot.sizes).reduce((sum, qty) => sum + qty, 0)}</td>
                    <td>${lot.addedDate}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteLot('${lot.lotNumber}')" data-lang-key="delete-button">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            setLanguage(currentLang);
        }
        
        function filterLots() {
            const searchText = document.getElementById('searchLot').value.toLowerCase();
            const rows = document.getElementById('lotList').getElementsByTagName('tr');
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            }
        }

        // Card Issue
        function loadIssuedCards() {
            const tbody = document.getElementById("issuedCardsList");
            tbody.innerHTML = "";
            issuedCards.forEach(card => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${card.cardNumber}</td>
                    <td>${card.lotNumber}</td>
                    <td>${card.style}</td>
                    <td>${card.size}</td>
                    <td>${card.quantity}</td>
                    <td>${card.workLine}</td>
                    <td>${card.issueDate}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="cancelIssue('${card.cardNumber}')" data-lang-key="cancel-button">Cancel</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            setLanguage(currentLang);
        }

        function filterIssuedCards() {
            const searchText = document.getElementById('searchIssuedCard').value.toLowerCase();
            const rows = document.getElementById('issuedCardsList').getElementsByTagName('tr');
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            }
        }

        function loadLotOptions() {
            const select = document.getElementById("issueLotNumber");
            select.innerHTML = `<option value="">${translations[currentLang]['select-lot']}</option>`;
            lots.forEach(lot => {
                const option = document.createElement("option");
                option.value = lot.lotNumber;
                option.textContent = lot.lotNumber;
                select.appendChild(option);
            });
            
            document.getElementById("issueLotNumber").addEventListener("change", function() {
                const lotNumber = this.value;
                const lot = lots.find(l => l.lotNumber === lotNumber);
                const styleInput = document.getElementById("issueStyle");
                const sizeSelect = document.getElementById("issueSize");
                
                styleInput.value = lot ? lot.style : "";
                sizeSelect.innerHTML = `<option value="">${translations[currentLang]['select-size']}</option>`;
                if (lot) {
                    Object.keys(lot.sizes).forEach(size => {
                        const option = document.createElement("option");
                        option.value = size;
                        option.textContent = size;
                        sizeSelect.appendChild(option);
                    });
                }
            });
        }
        
        // Worker Punch
        document.getElementById("punchCardNumber").addEventListener("input", function() {
            const cardNumber = this.value;
            const issuedCard = issuedCards.find(ic => ic.cardNumber === cardNumber);
            const cardRegistration = registeredCards.find(rc => rc.cardNumber === cardNumber);

            if (issuedCard && cardRegistration) {
                document.getElementById("punchLotNumber").value = issuedCard.lotNumber;
                document.getElementById("punchStyle").value = issuedCard.style;
                document.getElementById("punchSize").value = issuedCard.size;
                document.getElementById("punchQuantity").value = issuedCard.quantity;
                document.getElementById("punchWorkLine").value = issuedCard.workLine;
            } else {
                document.getElementById("punchLotNumber").value = '';
                document.getElementById("punchStyle").value = '';
                document.getElementById("punchSize").value = '';
                document.getElementById("punchQuantity").value = '';
                document.getElementById("punchWorkLine").value = '';
            }
        });

        document.getElementById("punchWorkerId").addEventListener("input", function() {
            const workerId = this.value;
            const worker = workers.find(w => w.workerId === workerId);
            document.getElementById("punchWorkerName").value = worker ? worker.workerName : '';
        });

        // --- Form Submissions and Deletions ---
        
        // Add Worker
        document.getElementById("workerForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const workerId = document.getElementById("workerIdEntry").value;
            const workerName = document.getElementById("workerNameEntry").value;
            const designation = document.getElementById("workerDesignationEntry").value;
            const section = document.getElementById("workerSectionEntry").value;
            const floor = document.getElementById("workerFloorEntry").value;
            const joinDate = document.getElementById("workerJoinDateEntry").value;
            const imageFile = document.getElementById("workerImageEntry").files[0];

            if (workers.some(w => w.workerId === workerId)) {
                showAlert("This Worker ID already exists!", 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const imageUrl = event.target.result;
                workers.push({ workerId, workerName, designation, section, floor, joinDate, image: imageUrl });
                activities.unshift({ time: new Date().toLocaleString(), activity: "Worker Added", user: currentUser.id, details: `${workerId} (${workerName})` });
                e.target.reset();
                loadRegisteredWorkers();
                loadActivities();
                showAlert("Worker added successfully!", 'success');
            };
            if (imageFile) {
                reader.readAsDataURL(imageFile);
            } else {
                showAlert("Please upload a worker image.", 'danger');
            }
        });

        // Delete Worker
        function deleteWorker(workerId) {
            if (confirm(`Are you sure you want to delete worker ${workerId}?`)) {
                workers = workers.filter(w => w.workerId !== workerId);
                activities.unshift({ time: new Date().toLocaleString(), activity: "Worker Deleted", user: currentUser.id, details: workerId });
                loadRegisteredWorkers();
                loadActivities();
                showAlert("Worker deleted successfully!", 'success');
            }
        }

        // Add Card
        document.getElementById("cardRegistrationForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const cardNumber = document.getElementById("cardNumber").value;
            if (registeredCards.some(card => card.cardNumber === cardNumber)) {
                showAlert("This card is already registered!", 'danger');
                return;
            }
            registeredCards.push({ cardNumber, registeredDate: new Date().toISOString().split('T')[0], status: "active" });
            activities.unshift({ time: new Date().toLocaleString(), activity: "Card Registered", user: currentUser.id, details: `${cardNumber}` });
            e.target.reset();
            loadRegisteredCards();
            loadActivities();
            updateDashboard();
            showAlert("Card registered successfully!", 'success');
        });
        
        // Deactivate Card
        function deactivateCard(cardNumber) {
            if (confirm(`Are you sure you want to deactivate card ${cardNumber}?`)) {
                const card = registeredCards.find(c => c.cardNumber === cardNumber);
                if (card) {
                    card.status = "inactive";
                    activities.unshift({ time: new Date().toLocaleString(), activity: "Card Deactivated", user: currentUser.id, details: cardNumber });
                    loadRegisteredCards();
                    loadActivities();
                    showAlert("Card deactivated successfully!", 'success');
                }
            }
        }

        // Bad Card Exchange
        document.getElementById("badCardForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const oldCardNumber = document.getElementById("oldCardNumber").value;
            const newCardNumber = document.getElementById("newCardNumber").value;
            
            const oldCard = registeredCards.find(c => c.cardNumber === oldCardNumber);
            const newCardExists = registeredCards.some(c => c.cardNumber === newCardNumber);
            
            if (!oldCard) {
                showAlert("Old card not found!", 'danger');
                return;
            }
            if (newCardExists) {
                showAlert("New card number is already in use!", 'danger');
                return;
            }

            oldCard.status = "inactive";
            registeredCards.push({ cardNumber: newCardNumber, registeredDate: new Date().toISOString().split('T')[0], status: "active" });

            const affectedIssuedCard = issuedCards.find(ic => ic.cardNumber === oldCardNumber);
            if (affectedIssuedCard) {
                affectedIssuedCard.cardNumber = newCardNumber;
            }
            
            const affectedProduction = productionData.filter(p => p.cardNumber === oldCardNumber);
            affectedProduction.forEach(p => p.cardNumber = newCardNumber);
            
            activities.unshift({ time: new Date().toLocaleString(), activity: "Bad Card Exchange", user: currentUser.id, details: `Old: ${oldCardNumber}, New: ${newCardNumber}` });
            e.target.reset();
            loadRegisteredCards();
            loadIssuedCards();
            loadActivities();
            showAlert("Bad card exchanged successfully!", 'success');
        });

        // Add Lot
        function addSizeQuantityInput() {
            const container = document.getElementById('sizeQuantityContainer');
            const div = document.createElement('div');
            div.className = 'form-group size-qty-group';
            div.innerHTML = `
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="form-control lotSize" placeholder="Size" required>
                    <input type="number" class="form-control lotQuantity" placeholder="Quantity" required>
                    <button type="button" class="btn btn-danger" onclick="this.parentNode.parentNode.remove()">-</button>
                </div>
            `;
            container.appendChild(div);
        }

        document.getElementById("lotForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const lotNumber = document.getElementById("lotNumber").value;
            const style = document.getElementById("lotStyle").value;
            const sizeInputs = document.querySelectorAll('.lotSize');
            const qtyInputs = document.querySelectorAll('.lotQuantity');
            
            if (lots.some(lot => lot.lotNumber === lotNumber)) {
                showAlert("This lot number already exists!", 'danger');
                return;
            }

            const sizes = {};
            for (let i = 0; i < sizeInputs.length; i++) {
                const size = sizeInputs[i].value.toUpperCase();
                const qty = parseInt(qtyInputs[i].value);
                if (size && !isNaN(qty)) {
                    sizes[size] = qty;
                }
            }

            if (Object.keys(sizes).length === 0) {
                showAlert("Please add at least one size and quantity.", 'danger');
                return;
            }
            
            lots.push({ lotNumber, style, sizes, addedDate: new Date().toISOString().split('T')[0] });
            activities.unshift({ time: new Date().toLocaleString(), activity: "Lot Added", user: currentUser.id, details: `${lotNumber} (${style})` });
            e.target.reset();
            document.getElementById('sizeQuantityContainer').innerHTML = `<div class="form-group size-qty-group">
                <label data-lang-key="lot-size-quantity">Size & Quantity</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="form-control lotSize" placeholder="Size" required>
                    <input type="number" class="form-control lotQuantity" placeholder="Quantity" required>
                    <button type="button" class="btn btn-success" onclick="addSizeQuantityInput()">+</button>
                </div>
            </div>`;
            loadLots();
            loadActivities();
            showAlert("Lot added successfully!", 'success');
        });
        
        // Delete Lot
        function deleteLot(lotNumber) {
            if (confirm(`Are you sure you want to delete lot ${lotNumber}?`)) {
                lots = lots.filter(l => l.lotNumber !== lotNumber);
                activities.unshift({ time: new Date().toLocaleString(), activity: "Lot Deleted", user: currentUser.id, details: lotNumber });
                loadLots();
                loadActivities();
                showAlert("Lot deleted successfully!", 'success');
            }
        }
        
        // Issue Card
        document.getElementById("cardIssueForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const cardNumber = document.getElementById("issueCardNumber").value;
            const lotNumber = document.getElementById("issueLotNumber").value;
            const workLine = document.getElementById("issueLine").value;
            const size = document.getElementById("issueSize").value;
            const quantity = parseInt(document.getElementById("issueQuantity").value);
            
            const card = registeredCards.find(c => c.cardNumber === cardNumber && c.status === "active");
            const issuedCardExists = issuedCards.some(ic => ic.cardNumber === cardNumber);
            const lot = lots.find(l => l.lotNumber === lotNumber);

            if (!card) { showAlert("Card is not registered or inactive!", 'danger'); return; }
            if (issuedCardExists) { showAlert("This card is already issued!", 'danger'); return; }
            if (!lot || !lot.sizes[size]) { showAlert("Lot, size, or quantity not found!", 'danger'); return; }
            if (quantity > lot.sizes[size]) { showAlert("Issue quantity exceeds available lot quantity!", 'danger'); return; }
            
            issuedCards.push({
                cardNumber, lotNumber, style: lot.style, size, quantity, workLine,
                issueDate: new Date().toLocaleString()
            });
            lot.sizes[size] -= quantity;

            activities.unshift({ time: new Date().toLocaleString(), activity: "Card Issued", user: currentUser.id, details: `${cardNumber} for ${lotNumber}` });
            e.target.reset();
            loadIssuedCards();
            loadLots();
            loadActivities();
            updateDashboard();
            showAlert("Card issued successfully!", 'success');
        });

        // Cancel Issue
        function cancelIssue(cardNumber) {
            if (confirm(`Are you sure you want to cancel this issue for card ${cardNumber}?`)) {
                const issuedCard = issuedCards.find(ic => ic.cardNumber === cardNumber);
                if (issuedCard) {
                    const lot = lots.find(l => l.lotNumber === issuedCard.lotNumber);
                    if (lot) {
                        lot.sizes[issuedCard.size] = (lot.sizes[issuedCard.size] || 0) + issuedCard.quantity;
                    }
                    issuedCards = issuedCards.filter(ic => ic.cardNumber !== cardNumber);
                    activities.unshift({ time: new Date().toLocaleString(), activity: "Card Issue Cancelled", user: currentUser.id, details: `${cardNumber}` });
                    loadIssuedCards();
                    loadLots();
                    loadActivities();
                    showAlert("Issue cancelled successfully!", 'success');
                }
            }
        }
        
        // Worker Punch
        document.getElementById("workerPunchForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const cardNumber = document.getElementById("punchCardNumber").value;
            const workerId = document.getElementById("punchWorkerId").value;
            
            const issuedCard = issuedCards.find(ic => ic.cardNumber === cardNumber);
            const worker = workers.find(w => w.workerId === workerId);

            if (!issuedCard) { showAlert("This card is not issued!", 'danger'); return; }
            if (!worker) { showAlert("Worker not found!", 'danger'); return; }
            
            const now = new Date();
            const date = now.toISOString().split('T')[0];
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            productionData.unshift({
                cardNumber, date, time, pieces: issuedCard.quantity, workerId, workerName: worker.workerName,
                workLine: issuedCard.workLine, lotNumber: issuedCard.lotNumber, style: issuedCard.style, size: issuedCard.size
            });
            
            issuedCards = issuedCards.filter(ic => ic.cardNumber !== cardNumber);
            
            activities.unshift({ time: now.toLocaleString(), activity: "Production Recorded", user: currentUser.id, details: `${issuedCard.quantity} pieces by ${worker.workerId}` });
            
            e.target.reset();
            loadIssuedCards();
            loadTodayProduction();
            loadActivities();
            updateDashboard();
            showAlert("Production recorded successfully!", 'success');
        });
        
        // --- Reporting and Tracking ---
        
        // Track Production
        function trackProduction() {
            const cardNumber = document.getElementById("trackCardNumber").value;
            const resultsContainer = document.getElementById("trackingResults");
            const productions = productionData.filter(prod => prod.cardNumber === cardNumber);
            
            if (productions.length === 0) {
                resultsContainer.innerHTML = `<div class="alert alert-danger" data-lang-key="no-prod-found">No production found for this card</div>`;
                setLanguage(currentLang);
                return;
            }
            
            let html = `
                <div class="card">
                    <h4>Card Tracking Results</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Worker</th>
                                <th>Pieces</th>
                                <th>Lot</th>
                                <th>Style</th>
                                <th>Size</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            productions.forEach(prod => {
                html += `
                    <tr>
                        <td>${prod.date}</td>
                        <td>${prod.time}</td>
                        <td>${prod.workerName} (${prod.workerId})</td>
                        <td>${prod.pieces}</td>
                        <td>${prod.lotNumber}</td>
                        <td>${prod.style}</td>
                        <td>${prod.size}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            resultsContainer.innerHTML = html;
        }

        // Generate Worker Report
        function generateWorkerReport() {
            const date = document.getElementById("reportWorkerDate").value;
            const resultsContainer = document.getElementById("reportResults");
            if (!date) { showAlert("Please select a date!", 'danger'); return; }
            const dateProductions = productionData.filter(prod => prod.date === date);
            if (dateProductions.length === 0) { resultsContainer.innerHTML = `<div class="alert alert-info">No production data found for ${date}</div>`; document.getElementById("reportResultsContainer").style.display = "block"; return; }
            const workerMap = new Map();
            dateProductions.forEach(prod => {
                if (!workerMap.has(prod.workerId)) {
                    workerMap.set(prod.workerId, { workerId: prod.workerId, workerName: prod.workerName, totalPieces: 0, workLine: prod.workLine, productions: [] });
                }
                const workerData = workerMap.get(prod.workerId);
                workerData.totalPieces += parseInt(prod.pieces);
                workerData.productions.push(prod);
            });
            let html = `<div class="card"><h4>Worker Production Report - ${date}</h4><table class="data-table"><thead><tr><th>Worker ID</th><th>Worker Name</th><th>Work Line</th><th>Total Pieces</th><th>Details</th></tr></thead><tbody>`;
            workerMap.forEach(workerData => {
                html += `<tr><td>${workerData.workerId}</td><td>${workerData.workerName}</td><td>${workerData.workLine}</td><td>${workerData.totalPieces}</td><td><button class="btn btn-info btn-sm" onclick="showWorkerDetails('${workerData.workerId}', '${date}')">View Details</button></td></tr>`;
            });
            html += `</tbody></table></div>`;
            resultsContainer.innerHTML = html;
            document.getElementById("reportResultsContainer").style.display = "block";
        }
        
        function showWorkerDetails(workerId, date) {
            const workerProductions = productionData.filter(prod => prod.workerId === workerId && prod.date === date);
            const worker = workers.find(w => w.workerId === workerId);
            let html = `<div class="card"><h4>Production Details for ${worker ? worker.workerName : workerId} - ${date}</h4><table class="data-table"><thead><tr><th>Time</th><th>Lot Number</th><th>Style</th><th>Size</th><th>Pieces</th></tr></thead><tbody>`;
            workerProductions.forEach(prod => {
                html += `<tr><td>${prod.time}</td><td>${prod.lotNumber}</td><td>${prod.style}</td><td>${prod.size}</td><td>${prod.pieces}</td></tr>`;
            });
            html += `</tbody></table><button class="btn btn-primary btn-sm" onclick="generateWorkerReport()" style="margin-top: 10px;">Back to Report</button></div>`;
            document.getElementById("reportResults").innerHTML = html;
        }
        
        // Generate Lot Report
        function loadReportLotOptions() {
            const select = document.getElementById("reportLotNumber");
            select.innerHTML = `<option value="">${translations[currentLang]['all-lots']}</option>`;
            lots.forEach(lot => {
                const option = document.createElement("option");
                option.value = lot.lotNumber;
                option.textContent = `${lot.lotNumber} (${lot.style})`;
                select.appendChild(option);
            });
        }

        function generateLotReport() {
            const lotNumber = document.getElementById("reportLotNumber").value;
            const resultsContainer = document.getElementById("reportResults");
            if (!lotNumber) {
                let html = `<div class="card"><h4>Lot Progress Report - All Lots</h4><table class="data-table"><thead><tr><th>Lot Number</th><th>Style</th><th>Size</th><th>Total Quantity</th><th>Completed</th><th>Progress</th></tr></thead><tbody>`;
                lots.forEach(lot => {
                    const lotProductions = productionData.filter(prod => prod.lotNumber === lot.lotNumber);
                    const totalCompleted = lotProductions.reduce((sum, prod) => sum + parseInt(prod.pieces), 0);
                    const totalLotQty = Object.values(lot.sizes).reduce((sum, qty) => sum + qty, 0);
                    const progress = Math.min(100, Math.round((totalCompleted / totalLotQty) * 100) || 0);
                    html += `<tr><td>${lot.lotNumber}</td><td>${lot.style}</td><td>${Object.keys(lot.sizes).join(', ')}</td><td>${totalLotQty}</td><td>${totalCompleted}</td><td><div style="background-color: #eee; width: 100%; height: 20px; border-radius: 4px;"><div style="background-color: ${progress < 50 ? '#f39c12' : progress < 80 ? '#3498db' : '#27ae60'}; width: ${progress}%; height: 100%; border-radius: 4px; text-align: center; color: white; font-size: 12px; line-height: 20px;">${progress}%</div></div></td></tr>`;
                });
                html += `</tbody></table></div>`;
                resultsContainer.innerHTML = html;
                document.getElementById("reportResultsContainer").style.display = "block";
                return;
            }
            const lot = lots.find(l => l.lotNumber === lotNumber);
            if (!lot) { showAlert("Lot not found!", 'danger'); return; }
            const lotProductions = productionData.filter(prod => prod.lotNumber === lotNumber);
            const totalCompleted = lotProductions.reduce((sum, prod) => sum + parseInt(prod.pieces), 0);
            const totalLotQty = Object.values(lot.sizes).reduce((sum, qty) => sum + qty, 0);
            const progress = Math.min(100, Math.round((totalCompleted / totalLotQty) * 100) || 0);
            let html = `<div class="card"><h4>Lot Progress Report - ${lotNumber}</h4><table class="data-table"><tr><th>Lot Number:</th><td>${lot.lotNumber}</td></tr><tr><th>Style:</th><td>${lot.style}</td></tr><tr><th>Size:</th><td>${Object.keys(lot.sizes).join(', ')}</td></tr><tr><th>Total Quantity:</th><td>${totalLotQty}</td></tr><tr><th>Completed:</th><td>${totalCompleted}</td></tr><tr><th>Progress:</th><td><div style="background-color: #eee; width: 100%; height: 20px; border-radius: 4px;"><div style="background-color: ${progress < 50 ? '#f39c12' : progress < 80 ? '#3498db' : '#27ae60'}; width: ${progress}%; height: 100%; border-radius: 4px; text-align: center; color: white; font-size: 12px; line-height: 20px;">${progress}%</div></div></td></tr></table><h5 style="margin-top: 20px;">Production History</h5><table class="data-table"><thead><tr><th>Date</th><th>Time</th><th>Worker</th><th>Pieces</th></tr></thead><tbody>`;
            lotProductions.forEach(prod => {
                html += `<tr><td>${prod.date}</td><td>${prod.time}</td><td>${prod.workerName} (${prod.workerId})</td><td>${prod.pieces}</td></tr>`;
            });
            html += `</tbody></table></div>`;
            resultsContainer.innerHTML = html;
            document.getElementById("reportResultsContainer").style.display = "block";
        }
        
        // Generate Attendance Report
        function generateAttendanceReport() {
            const month = document.getElementById("reportWorkerMonth").value;
            const resultsContainer = document.getElementById("reportResults");
            if (!month) { showAlert("Please select a month!", 'danger'); return; }
            const [year, reportMonth] = month.split('-');
            const daysInMonth = new Date(year, reportMonth, 0).getDate();
            const workerAttendance = new Map();
            workers.forEach(worker => {
                workerAttendance.set(worker.workerId, { name: worker.workerName, workLine: 'N/A', present: 0, absent: daysInMonth });
            });
            productionData.filter(p => p.date.startsWith(month)).forEach(p => {
                if (workerAttendance.has(p.workerId)) {
                    const data = workerAttendance.get(p.workerId);
                    const presentDates = new Set();
                    productionData.filter(prod => prod.workerId === p.workerId && prod.date.startsWith(month)).forEach(prod => presentDates.add(prod.date));
                    data.present = presentDates.size;
                    data.absent = daysInMonth - data.present;
                    data.workLine = p.workLine;
                }
            });
            let html = `<div class="card"><h4>Worker Attendance Report for ${new Date(month).toLocaleString('en-US', { month: 'long', year: 'numeric' })}</h4><table class="data-table"><thead><tr><th>Worker ID</th><th>Worker Name</th><th>Work Line</th><th>Present Days</th><th>Absent Days</th></tr></thead><tbody>`;
            workerAttendance.forEach((data, workerId) => {
                html += `<tr><td>${workerId}</td><td>${data.name}</td><td>${data.workLine}</td><td><span class="badge badge-success">${data.present}</span></td><td><span class="badge badge-danger">${data.absent}</span></td></tr>`;
            });
            html += `</tbody></table></div>`;
            resultsContainer.innerHTML = html;
            document.getElementById("reportResultsContainer").style.display = "block";
        }
        
        // --- User and Profile Management ---
        
        function loadPermissionsCheckboxes() {
            const container = document.getElementById('permissionCheckboxes');
            if (!container) return;
            container.innerHTML = '';
            for (const perm in permissionsMap) {
                const div = document.createElement('div');
                div.className = 'form-check';
                div.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${perm}" id="perm-${perm}">
                    <label class="form-check-label" for="perm-${perm}">${permissionsMap[perm][currentLang]}</label>
                `;
                container.appendChild(div);
            }
        }
        
        document.getElementById("addUserForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const userId = document.getElementById("newUserId").value;
            const name = document.getElementById("newUserName").value;
            const password = document.getElementById("newUserPassword").value;
            const role = document.getElementById("newUserRole").value;
            const permissions = Array.from(document.querySelectorAll('#permissionCheckboxes input:checked')).map(cb => cb.value);

            if (users.some(u => u.id === userId)) { showAlert("User ID already exists!", 'danger'); return; }
            if (role === 'admin' && permissions.length !== Object.keys(permissionsMap).length) {
                if (!confirm("Admin role should have all permissions. Continue anyway?")) return;
            }

            users.push({ id: userId, name, password, role, lastLogin: "", permissions, image: "" });
            activities.unshift({ time: new Date().toLocaleString(), activity: "User Added", user: currentUser.id, details: `${userId} (${role})` });
            e.target.reset();
            loadUserList();
            loadActivities();
            showAlert("User added successfully!", 'success');
        });
        
        function loadUserList() {
            const tbody = document.getElementById("userList");
            tbody.innerHTML = "";
            users.forEach(user => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.role}</td>
                    <td>${user.lastLogin || 'Never'}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.id}')" data-lang-key="delete-button">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            setLanguage(currentLang);
        }
        
        function deleteUser(userId) {
            if (currentUser.id === userId) {
                showAlert("You cannot delete your own account!", 'danger');
                return;
            }
            if (confirm(`Are you sure you want to delete user ${userId}?`)) {
                users = users.filter(u => u.id !== userId);
                activities.unshift({ time: new Date().toLocaleString(), activity: "User Deleted", user: currentUser.id, details: userId });
                loadUserList();
                loadActivities();
                showAlert("User deleted successfully!", 'success');
            }
        }

        document.getElementById("profileForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById("currentPassword").value;
            const newPassword = document.getElementById("newPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            
            if (currentPassword !== currentUser.password) {
                showAlert("Current password is incorrect.", 'danger');
                return;
            }
            if (newPassword !== confirmPassword) {
                showAlert("New passwords do not match.", 'danger');
                return;
            }
            
            currentUser.password = newPassword;
            showAlert("Password changed successfully!", 'success');
            e.target.reset();
        });

        function updateProfileImage() {
            const file = document.getElementById('profileImageInput').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    document.getElementById('profileImageDisplay').src = imageUrl;
                    document.getElementById('userAvatar').innerHTML = `<img src="${imageUrl}" alt="User Avatar">`;
                    currentUser.image = imageUrl;
                    showAlert("Profile picture updated successfully!", 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // Initialize application
        initializeSampleData();
        setLanguage(currentLang);
    </script>
</body>
</html>
